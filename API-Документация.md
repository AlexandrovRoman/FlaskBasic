Документация интерфейса программирования приложений интернет-ресурса [GosRab](https://pfproject.herokuapp.com/) 

------

##### 1.Термины и сокращения используемые в документации:

| Термин/Cокращение | Описание                                                     |
| ----------------- | ------------------------------------------------------------ |
| API               | Application Programming Interface,интерфейс программирования приложений |
| JSON              | Javascript Object Notation, основанный на синтаксисе Javascript формат обмена данными |
| JWT               | JSON Web Token, *JSON*-объект используемый для безопасной передачи информации |
| ID                | Идентификационный номер                                      |

##### 2. Назначение API:

Ниже представлены различные действия для которых предназначен API данного ресурса:

- Получение сведений о организациях,пользователях,свободных вакансиях.
- Создание новых пользователей и организаций.
- Автоматизированная работа с вышеперечисленными группами.

**3. Условия использования:**

Все запросы должны осуществляться по данному адресу: https://pfproject.herokuapp.com/api

На все запросы возвращается JSON-объект в качестве ответа.

В документации указан тип каждого запроса,с указанием его типа(`GET`, `POST` или `DELETE`), а так же все параметры,которые можно передать с запросом(обязательные параметры помечены звездочкой "*").

**4. Авторизация и деавторизация:**

Существует два вида авторизации и деавторизации,открывающие доступ к соответсвующим методам API:

**Авторизация для пользователей:**

- `GET` `/login/<string:email>/<string:password>` 

  Авторизует пользователя для использования API при передаче корректных данных:

  `email `(эл.почта) и `password `(пароль) .Перед использованием этого метода необходима регистрация на сайте.

  <u>Пример ответа:</u>

  ```json
  {
      "authorization": "OK"
  }
  ```

  <u>Пример ошибки:</u>

  Неверная эл.почта или пароль

  ```json
  {
      "error": "incorrect email or password"
  }
  ```

  

- `DELETE` `/login`

  Закрытие данной сессии.

  <u>Пример ответа:</u>

  ```json
  {
      "sign out": "OK"
  }
  ```

  

**Авторизация для организаций:**

- `GET` `/org_login/<int:org_id>/<string:jwt> `

  Авторизует организациюдля использования API при передаче корректных данных:

  `org_id `(ID организации) и `jwt `(JWT организации).ID и JWT можно узнать при создании организации .Перед использованием этого метода необходимо непосредственно создать организацию на сайте.

  <u>Пример JWT:</u>

  ```
  eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.
  eyJzdWIiOiIxMjM0NSIsIm5hbWUiOiJKb2huIEdvbGQiLCJhZG1pbiI6dHJ1ZX0K.
  LIHjWCBORSWMEibq-tnT8ue_deUqZx1K0XxCOXZRrBI
  ```

  <u>Пример ответа:</u>

  ```json
  {
      "authorization": "OK"
  }
  ```

  <u>Пример ошибки:</u>

  Неверный ID организцаии или JWT

  ```json
  {
      "error": "incorrect Organization ID or JWT"
  }
  ```

  

- `DELETE` `/org_login`

  Деавторизует организацию данной сессии.

  <u>Пример ответа:</u>

  ```json
  {
      "sign out of organization": "OK"
  }
  ```

  

Далее указано,какие методы требуют той или иной авторизации,а какие нет.



**5. Использование API:**



**Пользователь:**

- `GET` `/user/<int:user_id>` 

  *Авторизация пользователя: Требуется*

  Возвращает публичные данные о пользователе с идентификационным номером `user_id`

  <u>Пример ответа:</u>

  ```json
  {
      "user": {
          "birth_date": "1960-03-21",
          "fathername": "Всеволодов",
          "id": 3,
          "name": "Герман",
          "surname": "Чехов"
      }
  }
  ```

  В приведенной ниже таблице описано значение каждого из возвращаемых параметров:

  | Параметр   | Описание                   |
  | ---------- | -------------------------- |
  | name       | Имя пользователя           |
  | surname    | Фамилия пользователя       |
  | fathername | Отчество пользователя      |
  | id         | ID пользователя            |
  | birth_date | Дата рождения (ГГГГ-ММ-ДД) |

  <u>Примеры ошибок:</u>

  Не осуществлена авторизация:

  ```json
  {
      "error": "Login before using API"
  }
  ```

  Передан не существующий `user_id`:

  ```json
  {
      "message": "User with id 3 not found"
  }
  ```

  

- `DELETE` `/user/<int:user_id>` 

  *Авторизация пользователя: Требуется*
  
  Удаляет пользователя с идентификационным номером `user_id`, при наличии на то прав.
  
  <u>Пример ответа:</u>
  
  ```json
  {
      "deleting": "OK"
  }
  ```
  
  <u>Примеры ошибок:</u>
  
  Не осуществлена авторизация
  
  ```json
  {
      "error": "Login before using API"
  }
  ```
  
  Попытка удалить чужого пользователя
  
  ```json
  {
      "error": "delete is not allowed to this user"
  }
  ```
  
  

- `POST` `/user` 

  *Авторизация пользователя: Не требуется*

  Создает нового пользователя в системе и возвращает о нем базовые данные.После создания отправляется письмо на переданный адрес электронной почты,для подтверждения аккаунта.
  
  С запросом должны передаваться следующие параметры:

  | Параметр запроса | Описание                                                    |
  | ---------------- | ----------------------------------------------------------- |
  | *name            | Имя пользователя, **не должно содержать цифр**              |
  | *surname         | Фамилия пользователя, **не должна содержать цифр**          |
  | *fathername      | Отчество пользователя, **не должно содержать цифр**         |
  | *email           | Эл. почта, **не должна быть раннее использована на сайте.** |
  | *password        | Пароль                                                      |
  
  <u>Пример ответа:</u>
  
  ```json
  {
      "adding": "OK",
      "user": {
          "birth_date": "2000-12-13",
          "fathername": "Отчество",
          "id": 54,
          "name": "Имя",
          "surname": "Фамилия"
      }
  }
  ```
  
  <u>Примеры ошибок:</u>
  
  Отсутсвуют некоторые необходимые параметры
  
  ```json
  {
      "message": {
          "fathername": "Missing required parameter in the JSON body or the post body or the query string"
      }
  }
  ```
  
  Передана эл. почта зарегистрированная в системе
  
  ```json
  {
      "error": "email already taken"
  }
  ```
  
  Некоректный адрес эл. почты
  
  ```json
  {
      "error": "invalid email"
  }
  ```
  
  

**Организация:**

- `GET` `/organization` 

  *Авторизация организации: Требуется*

  Возвращает данные об организации, которая была авторизована в данной сессии.

  <u>Пример ответа:</u>

  ```json
  {
      "organization": {
          "api_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwYXlsb2FkIjoiXHUwNDFlXHUwNDQwXHUwNDMzXHUwNDMwXHUwNDNkXHUwNDM4XHUwNDM3XHUwNDMwXHUwNDQ2XHUwNDM4XHUwNDRmIDEiLCJpYXQiOjE1ODkzMTA5MTUsImV4cCI6MTU4OTkxNTcxNX0.KrKVMjLAw_CbV3xX1YonIDDocgr9DrVimIdn3QtG1DI",
          "creation_date": "2020-05-12",
          "free_vacancies": [
              {
                  "id": 2,
                  "org_id": 1,
                  "salary": 30000,
                  "title": "Кондитер"
              },
              {
                  "id": 3,
                  "org_id": 1,
                  "salary": 50000,
                  "title": "Директор"
              },
              {
                  "id": 4,
                  "org_id": 1,
                  "salary": 25000,
                  "title": "Администратор"
              },
              {
                  "id": 5,
                  "org_id": 1,
                  "salary": 27500,
                  "title": "Сис.Админ"
              }
          ],
          "id": 1,
          "name": "Организация 1",
          "org_desc": "Печём с любовью",
          "org_type": "ООО",
          "owner_id": 2,
          "staff": [
              {
                  "id": 1,
                  "org_id": 1,
                  "resume": [],
                  "salary": 10000,
                  "title": "Кондитер",
                  "worker_id": 1
              }
          ]
      }
  }
  ```

  | Параметр       | Описание                                  |
  | -------------- | ----------------------------------------- |
  | api_token      | JWT организации                           |
  | creation_date  | Дата основания (ГГГГ-ММ-ДД)               |
  | free_vacancies | Список свободных вакансий(Подробнее ниже) |
  | id             | ID организации                            |
  | org_desc       | Описание организации                      |
  | org_type       | Тип организации                           |
  | owner_id       | ID пользователя-владельца организации     |
  | staff          | Список сотрудников(Подробнее ниже)        |

  Список свободных вакансий имеет следующие параметры своих элементов:

  | Параметр | Описание                                |
  | -------- | --------------------------------------- |
  | id       | ID вакансии                             |
  | org_id   | ID организации предоставляющей вакансию |
  | salary   | Зарплата                                |
  | title    | Название вакансии/должность             |

  Список сотрудников отличается от списка вакансий лишь двумя дополнительными параметрами элементов:

  | Параметр  | Описание                                                  |
  | --------- | --------------------------------------------------------- |
  | resume    | Поданное резюме                                           |
  | worker_id | ID пользователя занимающего эту должность в данный момент |

  <u>Пример ошибки:</u>

  Не осуществлена авторизация

  ```
  {
      "error": "Login with your organization before using Organizations API"
  }
  ```

  

- `DELETE` `/organization` 

  *Авторизация организации: Требуется*
  
  Удаляет авторизованную в данной сессии организацию
  
  <u>Пример ответа:</u>
  
  ```json
  {
      "deleting": "OK"
  }
  ```
  
  <u>Пример ошибки:</u>
  
  Не осуществлена авторизация
  
  ```json
  {
      "error": "Login with your organization before using Organizations API"
  }
  ```
  
  

- `POST` `/organization` 

  *Авторизация организации: Не требуется*

  *Авторизация пользователя: Требуется*

  Создает новую организацию в системе и возвращает информацию о ней. Организация будет прикреплена к вошедшему пользователю, если пользователь не вошел,то запрос не будет принят.
  
  С запросом должны передаваться следующие параметры:

  | Параметр запроса | Описание             |
  | ---------------- | -------------------- |
  | *name            | Название организации |
  | *org_type        | Тип организации      |
  | *org_desc        | Описание организации |
  
  <u>Пример ответа:</u>
  
  ```json
  {
      "adding": "OK",
      "organization": {
          "api_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwYXlsb2FkIjoiXHUwNDFkXHUwNDIzIFx1MDQ0Mlx1MDQzMlx1MDQzMFx1MDQ0MCIsImlhdCI6MTU4OTM5NTkwOSwiZXhwIjoxNTkwMDAwNzA5fQ.eZINE5M01wWZ37CTFGoz_5ud_OwHI2NBa48XjgFWOrU",
          "creation_date": "2020-05-13",
          "id": 24,
          "name": "РЖД",
          "org_desc": "Ответственны за транспортировку граждан",
          "org_type": "ПАО",
          "owner_id": 54
      }
  }
  ```
  
  <u>Примеры ошибок:</u>
  
  Отсутсвуют некоторые необходимые параметры
  
  ```json
  {
      "message": {
          "name": "Missing required parameter in the JSON body or the post body or the query string"
      }
  }
  ```
  
  Не осуществлена авторизация:
  
  ```json
  {
      "error": "Login before using API"
  }
  ```



**Вакансии:**

- `GET` `/vacancy`

  *Авторизация пользователя: Требуется*

  Возвращает список из 1000 всех не занятых вакансий из всех доступных организаций, начиная с `offset`

  Передаваемый параметр:
  
  | Параметр запроса | Описание                                                     |
  | ---------------- | ------------------------------------------------------------ |
  | offset           | Необязательный параметр. Обозначает ID вакансии с которой будет выведена первая тысяча вакансий |
  
  Пример ответа:
  
  ```json
  {"vacancy":
   [{"id":2,
     "org_id":1,
     "salary":30000,
     "title":"Кондитер"},
    {"id":3,
     "org_id":1,
     "salary":50000,
     "title":"Директор"}]
  }
  ```